\chapter{\label{par_est}Parameter estimation using SOAP}
%%%%%%%%%%%%
%%%%%%%%%%%%
%%%%%%%%%%%%
%%%%%

Throughout Sec.~\ref{soap} and \ref{machine} we developed techniques which could identify whether a potential signal is present within a small frequency band ($0.1 Hz$) and return the most likely frequency track if the signal in that band.
This is useful information for all-sky searches as it can limit the parameter space for deeper searches such as those described in Sec.~\ref{searchcw:search:targeted}. 
However, this only limits the parameters space to a smaller frequency band, and potentially the frequency and derivative if we used the Viterbi track information.
This still leaves a large parameter space which a more sensitive method would have to search through.
In particular the sky position of the source has to be sampled finely as \gls{LIGO} can accurately localise a \gls{CW} source.
This is because the source is observed at multiple positions as the earth orbits sun, giving an effective aperture of the earth's orbital radius.
The SOAP search would therefore benefit if it could provide more information on the astrophysical source.

In this chapter I will outline a Bayesian method which uses the output Viterbi tracks of the SOAP search in Sec.~\ref{soap} to return some astrophysical parameters of a source.
Sec.~\ref{par_est:freq} will outline the model of the frequency evolution of a \gls{CW} from a source with a slowly varying frequency,
Sec.~\ref{par_est:bayes} will outline the Bayesian model for this analysis and Sec.~\ref{par_est:results} will show the results from testing on simulated signals.

%%%%
%%%%
\section{\label{par_est:freq}Pulsar frequency evolution}
%%%%
%%%%

The SOAP search returns a Viterbi track, where if this track follows the frequency of a pulsar signal, frequency evolution contains information of the sky position ($\alpha, \delta$) and the frequency of the source $f$ and its derivative $\dot{f}$ where we ignore higher order frequency derivatives.
From the Viterbi track, we should then be able to extract this information as we have a model for the phase evolution (and therefore frequency evolution) of the source described in Eq.~\ref{searchcw:model:phase} in Sec.~\ref{searchcw:model}.
To relate this phase evolution to the sky position parameters, we can look closer at Eq.~\ref{searchcw:model:ssbtime}, where we describe the shift in arrival time due to the earths motion. 

The second term in Eq.~\ref{searchcw:model:ssbtime} describes the Doppler shift due to the earth's orbit and rotation.
Where the $\bm{r}$ is the position of the detector and $\bm{n}$ is a unit vector in the direction of the source. 
As in \citep{schutz1998DataAnalysis}, we use the coordinate frame in the \gls{SSB} where the $z$ axis is perpendicular to the ecliptic and the $x$ axis is parallel to the celestial sphere.
In this frame the unit vector pointing towards the star can be written as 
\begin{equation}
    \label{par_est:freq:unit}
    \bm{n} = 
    \left(
    \begin{matrix}
        1 & 0 & 0  \\
        0 & \cos \epsilon & \sin \epsilon \\
        0 & -\sin \epsilon & \cos \epsilon \\
    \end{matrix} \right)
    \left(
    \begin{matrix}
        \cos(\alpha)\cos(\delta)  \\
        \sin(\alpha)\cos(\delta) \\
        \sin(\delta) \\
    \end{matrix} \right),
\end{equation}
where $\alpha$ and $\delta$ are the right ascension and declination (sky position) of the source and $\epsilon$ is the angle between the ecliptic and the earth's equator.
The first matrix in Eq.~\ref{par_est:freq:unit} describes a rotation from the \joe{earths} frame where $\alpha$ and $\delta$ are measured to the \gls{SSB} frame. 
The second matrix transforms the sky position parameters to their component $x,y,z$ coordinates.

The position vector of the earth at a time $t$, $\bm{r}$ in Eq.~\ref{searchcw:model:ssbtime}, can split into the addition of two components, the position due to the orbit of the earth and position due to the rotation of the earth.
The position of the earth in its orbit is described in cartesian coordinates as
\begin{equation}
    \bm{r}_{orb} = R_{\mathrm{O}}
    \left(
    \begin{matrix}
        \cos{\left( \Omega_{\mathrm{O}} t + \phi_{\omega){O}}  \right)}  \\
        \sin{\left( \Omega_{\mathrm{O}} t + \phi_{\omega){O}}  \right)} \\
        0 \\
    \end{matrix} \right),
\end{equation}
where $R_{\mathrm{O}}$ is the radius of the earth's orbit (1 AU), $\Omega_{\mathrm{O}}$ is the angular frequency of the earth's orbit $2\pi/T_{\mathrm{O}}$, where $T_{\mathrm{O}}$ is one year and $\phi_{\omega){O}}$ is some phase which defines the position of the earth in its orbital motion.
The position due to the rotation of the earth can then be described by 
\begin{equation}
    \bm{r}_{rot} = R_{\mathrm{R}}
    \left(
    \begin{matrix}
        1 & 0 & 0  \\
        0 & \cos \epsilon & \sin \epsilon \\
        0 & -\sin \epsilon & \cos \epsilon \\
    \end{matrix} \right)
    \left(
    \begin{matrix}
        \cos{(\lambda)}\cos{\left( \Omega_{\mathrm{R}} t + \phi_{\omega){R}}  \right)}  \\
        \cos{(\lambda)}\sin{\left( \Omega_{\mathrm{R}} t + \phi_{\omega){R}}  \right)} \\
        \sin{(\lambda)} \\
    \end{matrix} \right),
\end{equation}
where $R_{\mathrm{R}}$ is the radius of the earth, $\Omega_{\mathrm{R}}$ is the angular frequency of the earth's rotation $2\pi/T_{\mathrm{R}}$, where $T_{\mathrm{R}}$ is one day, $\phi_{\omega){O}}$ is some phase which defines the position of the earth in its rotational motion and $\lambda$ is the latitude of the detectors site.
These two components can then be added to find the location of the detector in the \gls{SSB} frame
\begin{equation}
    \bm{r} = \bm{r}_{orb} + \bm{r}_{rot}.
\end{equation}

We can now describe the phase evolution of the signal at the detectors site from just the sky position ($\alpha, \delta$) and frequency and its derivative $f,\dot{f}$. 
The frequency of a pulsars signal at any point on the frequency track is then defined by the derivative of the phase with respect to time
\begin{equation}
    f = \frac{d\Phi}{dt}, 
\end{equation}
where $\Phi$ is defined in Eq.~\ref{searchcw:model:phase}.
\joe{maybe add the actual frequency evolution equation}

%
%
\section{\label{par_est:bayes}Bayesian Model}
%
%

As described in Sec.~\ref{par_est:freq} we have a model of a pulsars frequency evolution and we have our Viterbi track which is our observation of a frequency track.
We would now like to estimate the parameters $\bm{\theta} = \left\{\alpha, \delta, f, \dot{f} \right\}$ of a pulsar given that we have observed the frequency track $\bm{V}$.
To do this we use a Bayesian model, where the idea was introduced in Sec.~\ref{intro:prob:bayes}, where we rewrite Bayes formula in terms of this problem
\begin{equation}
    \label{par_est:bayes:eqn}
    p(\bm{\theta} \mid \bm{V}, I) = \frac{p(\bm{\theta}) p(\bm{V} \mid \bm{\theta}, I)}{p(\bm{V} \mid I)}
\end{equation}
where $p(\bm{\theta} \mid \bm{V}, I)$ is the posterior which we are interested in, $p(\bm{\theta})$ is the prior, $p(\bm{V} \mid \bm{\theta}, I)$ is the likelihood and $\bm{V} \mid I)$ is the evidence.
The following sections will describe how we set up the prior and likelihood for this problem.

%
%
\subsection{\label{par_est:bayes:likelihood}Likelihood}
%
%

The likelihood describes how the noise of the data is distributed, i.e. if we subtracted the model frequency track $\bm{M}(\bm{\theta})$ from our observed Viterbi track $\bm{V}$, what is the distribution of these values.
If the simulated pulsar signal has an infinitely large \gls{SNR} then the Viterbi track would follow the pulsars frequency track exactly, which would leave a noise distribution of 0 with no variance. 
If conversely, the \gls{SNR} was zero then the Viterbi track would wander randomly through the frequency band and the noise would have a large variance in frequency.
The noise distribution of our data, i.e. $\bm{M}(\bm{\theta}) - \bm{V}$, is then dependent on the \gls{SNR} $\rho$ of the signal. 
Given that this is a difficult distribution to find analytically, we calculate it empirically using many simulated signals.

In Sec.~\ref{machine:results} we generated $\mathcal{O}(10^{4})$ simulated \gls{CW} signals in Gaussian noise between 40 and 500 Hz, which had \gls{SNR} $\rho$ uniformly between 20 and 200 and source parameters which follow that in Tab.~\ref{soap:results:parameters}. For each of these simulations, the SOAP search using the line-aware statistic with parameters from Sec.~\ref{soap:results} returns a Viterbi track associated with the simulated parameters.
For each simulation we can calculate the difference between the Viterbi track and model frequency track $M_i(\bm{\theta}) - V_i$ for each element in the track, where the likelihood $\mathcal{L}$ can be estimated by taking the \gls{KDE} of all our values of $M_i - V_i$.
In this case our likelihood is also dependent on \gls{SNR}, therefore, we split our simulations into bands of width \gls{SNR} 2 between 20 and 200, this gives $\sim 300$ simulated tracks within each \gls{SNR} bound.
Figure \ref{par_est:bayes:likelihood:kde142} shows an example of the \glspl{KDE} of a subset of the likelihood bins. 
The sharp peaks in the center of each sub plot in Fig.~\ref{par_est:bayes:likelihood:kde142} represents simulations where the Viterbi track is close to the simulated pulsar track, and the broader distributions represent areas of the Viterbi track has not identified the pulsar track but is wandering randomly.
The sub plots in Fig.~\ref{par_est:bayes:likelihood:kde142} show that as the \gls{SNR} increases the distribution is more closely centred around 0, i.e. the Viterbi and pulsar tracks are similar, which is expected.
%
\begin{figure}[hpt]

    \centering
    \includegraphics[width=\linewidth]{C5_parameter/KDE_range_50_100.pdf}
    \caption[KDE of likelihood in different \gls{SNR} ranges]{This figure shows the \gls{KDE} estimates of the probability density of the differences between the simulated (injected) pulsar frequency track and the recovered Viterbi track for a number of \gls{SNR} ranges. The difference in the tracks is measured in discrete frequency bins. Each \gls{KDE} is generated from $\sim 300$ simulations which each have $\sim 400$ elements in their frequency tracks. This shows a subset of the binned likelihoods between the range of \gls{SNR} 50 and 150.}
    \label{par_est:bayes:likelihood:kde142}
    
    \end{figure}
%

This does introduce one more parameter to search over in out Bayesian model, which is the \gls{SNR} ($\rho$) of the signal.
These \glspl{KDE} $\mathcal{L}$ are the used in the likelihood function $p(\bm{V} \mid \bm{\theta}, \rho, I)$ in the Bayesian model in Eq.~\ref{par_est:bayes:eqn}, where we now have five parameters in our model $\alpha, \delta, f, \dot{f}$ and $\rho$.
Our likelihood for a given Viterbi track input is
\begin{equation}
    p(\bm{V} \mid \bm{\theta}, \rho, I) = \frac{1}{N}\prod_{i = 1}^{N} \mathcal{L}(M_i(\bm{\theta}) - V_i, \rho) ,
\end{equation}
where $N$ is the length of the Viterbi track $\bm{V}$. 
As the likelihood $\mathcal{L}$ is binned in \gls{SNR} $\rho$, and $\rho$ is a continuous value, the likelihood is calculated as the weighted sum of the surrounding likelihood bins, where the weights are the fractional separation of $\rho$ from the bin centers. 

%
\subsection{Prior}
%
We set up a simple prior which does not assume much about the parameters, other than limits on their range. 
We use a flat prior for $\alpha$ between $[0,2\pi]$, a flat prior in $\sin{\delta}$ between [-1,1], a flat prior in $f$ in the range of the 0.1 Hz wide sub-band which SOAP searched through, a flat prior in the frequency derivative in the range $[-1\cdot 10^{9},1\cdot 10^{9}]$ and a flat prior for the \gls{SNR} $\rho$ in the range $[50,200]$.


\clearpage

%%%%
%%%%
\section{\label{par_est:results}Results}
%%%%
%%%%

The method described in Sec.~\ref{par_est:bayes} takes in a Viterbi track and uses this to estimate the five dimensional posterior distribution $p\left(\left\{ \alpha, \delta, f, \dot{f}, \rho \right\} \mid \bm{V}, I \right)$.
To calculate this posterior we use a technique known as nested sampling, specifically the package {\it Dynesty} \citep{speagle2019DynestyDynamic}, which is explained in Sec.~\ref{intro:prob:bayes}. \joe{explain more in the return of intro chapter}

As an example, we can simulate a \gls{CW} signal with neutron star parameters 
\begin{equation}
    \label{par_est:results:examplepars}
    \begin{split}
        \alpha &= 4.2 \; \rm{rad}\\
        \delta &= -0.06 \; \rm{rad} \\
        f &= 148.23 \; \rm{Hz}\\
        \dot{f} &= -3.55e-15 \; \rm{Hz/s}\\
        \rho &= 151,\\
    \end{split}
\end{equation}

and generate the associated spectrograms for the \gls{LIGO} detectors H1 and L1.
The SOAP search from Sec.~\ref{soap} is then run using the line-aware statistics the same parameters as in Sec.~\ref{soap:results}, the output Viterbi track is then plotted with the neutron stars frequency track in Fig.~\ref{par_est:results:freqtrack}.
%
\begin{figure}[ht]

    \centering
    \includegraphics[width=\linewidth]{C5_parameter/example_freqtrack.pdf}
    \caption[Frequency track of injected signal]{ Example simulated \gls{CW} frequency using parameters in Eq.~\ref{par_est:results:examplepars} and the Viterbi track recovered from the simulation. The track is samples once per day, where the oscillation visible here is due to the Doppler modulation of the Earth's orbit.}
    \label{par_est:results:freqtrack}
    
\end{figure}
%
In this case the Viterbi track closely follows the simulated neutrons star frequency track.

The Bayesian analysis described in Sec.~\ref{par_est:bayes} is then run using this Viterbi track as input, this returns the marginal posterior distributions shown in Fig.~\ref{par_est:results:example_posterior}, where the simulated parameters are marked in orange.
In this example, the injected parameter values are within the marginal posterior distributions for all of the parameters.
The frequency is has a width of N in band N \joe{mention all by sky params here}
%
\begin{figure}[pt]

    \centering
    \includegraphics[width=\linewidth]{C5_parameter/cornerplot.pdf}
    \caption[KDE of likelihood in different \gls{SNR} ranges]{This figure shows an example of the posterior distribution of a signal with \gls{SNR} 151. Each panel shows the marginal distributions for each parameter, where the parameters used for the simulation are marked in orange. In this example each of the posteriors match well with the injected parameters, but the sky position is bimodal. }
    \label{par_est:results:example_posterior}
    
\end{figure}
%
The distribution of the sky parameters are easier to interpret when they are projected onto a skymap, therefore, Fig.~\ref{par_est:results:example_skypos} the parameters $\alpha$ and $\delta$ are shown on a sky projection.
The Viterbi tracks and pulsar frequency tracks used in this analysis are sampled once a day, therefore, we should only see the doppler modulation from the orbit of the earth around the sun.
In the ecliptic frame, i.e. where the $z$ axis is perpendicular to the orbital plane of the earth, for any ecliptic longitude, there are two sky positions at opposite ecliptic latitudes which will return the same frequency track. 
This then means that we would expect the marginal posterior distribution to have two modes on the sky at these two locations, where this can be seen in Fig.~\ref{par_est:results:example_posterior} and \ref{par_est:results:example_skypos}.
The sky position parameters of the neutron star are in the equatorial coordinate system, therefore these have been transformed into the ecliptic frame such that the sky position posteriors easier to interpret.
%
\begin{figure}[ht]
    \centering
    \includegraphics[width=\linewidth]{C5_parameter/skypos_ecliptic.pdf}
    \caption[Example of posterior of sky position in ecliptic frame]{This figure shows an example of the marginal posterior distribution of the sky position in the ecliptic frame $\alpha^{\rm{ecliptic}},\delta^{\rm{ecliptic}}$ of a signal with \gls{SNR} 144. The overlayed panel is a zoomed area around the posterior distribution, where the orange marker shows the injected parameters.}
    \label{par_est:results:example_skypos}
    
\end{figure}
%

%
%
\subsection{Simulations}
%
%
To test this method, we generate a set of simulations of the Gaussian noise spectrograms of \gls{CW} signals as in Sec.~\ref{soap:results} and Sec.~\ref{machine:results}.
This is the same simulated test set from Sec.~\ref{machine:results}, where \gls{CW} signals were injected into 50\% of the 0.1 Hz wide sub-bands between between 40 and 500 Hz, with the parameters as described in Tab.~\ref{soap:results:parameters}. 
The SOAP search using the line aware statistic with parameters in Tab.~\ref{soap:res} \joe{table} is run on each sub-band, where the Viterbi track and \gls{CW} signal parameters $\alpha, \delta, f, \dot{f}$ associated with each simulation are recorded.
The Viterbi track can then be used to run the Bayesian analysis described in Sec.~\ref{par_est:bayes}.
In these simulations, we have 2300 simulated signals which have an \gls{SNR} range between 20 and 200, where for this test we randomly select 200 of these simulations.

\if
However, as the \gls{SNR} of the simulations decreases, the probability of SOAP identifying the signal decreases, therefore, we only want to run the Bayesian parameter estimation on signals which are most likely to be astrophysical.
Therefore, as in Sec.~\ref{soap:results}, we find the false alarm rate, which is the fraction of bands which contain no injection and has a Viterbi statistic which exceeds a given threshold, where this is set to 0\% for this test.
We can then select all of the sub-bands which have a Viterbi statistic above this threshold for further investigation, where with a 0\% false alarm rate we have 2000 \joe{ecaxt number} injections to investigate.
The Viterbi statistics for each of these injections can be seen in Fig.~\ref{par_est:results:all_viterbi}, where the 0\% false alarm value is marked.
%
\begin{figure}
    \centering
    \includegraphics[width=\linewidth]{C5_parameter/viterbi_hist.pdf}
    \caption[All Viterbi statistics]{This figure shows a histogram of the Viterbi statistics from each of the 0.1 Hz wide sub bands in this test. \joe{more}}
    \label{par_est:results:all_viterbi}
\end{figure}
\fi


\subsubsection{P-P plot}

The p-p plot is a mechanism to validate the effectiveness of the Bayesian model and computation using many simulations.
From Sec.~\ref{par_est:results} we have the output posterior distribution $p(\bm{\theta} \mid \bm{V}, I)$, or more correctly we have $N$ samples from this distribution $\bm{\theta}_i$, and we have the injected parameters $\bm{\theta}_{\rm{inj}}$.
For each simulation, we can calculate the posterior quantile $q(\theta_{\rm{inj}})$ from the marginal posterior distribution
\begin{equation}
    q(\theta_{\rm{inj}}) = P(\theta_{\rm{inj}} > \theta) = \frac{1}{N} \sum_{i=1}^{N} H(\theta_{\rm{inj}} - \theta_i),
\end{equation}
where $H(x)$ is the Heaviside step function. 
This calculates the fraction of the marginal posterior distribution which has a parameter $\theta$ less than the injected parameter $\theta_{\rm{inj}}$ \citep{cook2006ValidationSoftware}.
If the model and computation of the posterior is valid, then as the number of samples approaches infinity ($N \rightarrow \infty$), the posterior quantile $q(\theta_{\rm{inj}})$ should follow a uniform distribution $[0,1]$ \citep{cook2006ValidationSoftware}.
This then provides a method to check the validity of our analysis.

For each of our simulations we can calculate $q(\theta_{\rm{inj}})$, such that we have values $\bm{q}_{\theta}$, where the fraction of simulations which fall within a given \gls{CI} $C$ is the cumulative distribution of $\bm{q}_{\theta}$, i.e. $P(\bm{q}_{\theta} > C)$, where $C$ ranges between $[0,1]$.
If $q(\theta_{\rm{inj}})$ and therefore $\bm{q}_{\theta}$ follows a normal distribution, then $P(\bm{q}_{\theta} > C) = C$ \citep{cook2006ValidationSoftware}.
Plotting $P(\bm{q}_{\theta} > C)$ against $C$ for each parameter $\theta$, then shows the fraction of simulations which have a $q(\theta_{\rm{inj}})$ within some \gls{CI} $C$, this is known as a p-p plot.

If the analysis is valid, i.e the marginal posterior distributions agree with the injected parameters, then this plot should follow a straight diagonal line, indicated by the black line in Fig.~\ref{par_est:results:ppplot_example}.
If the marginal posterior distribution is shifted to right of the injected parameters, shown in the first panel of Fig.~\ref{par_est:results:ppplot_example}, i.e. the true value lies in the lower tail of the posterior for each simulation, then the p-p plot will show a curve above the diagonal.
Similarly, if the marginal posterior distribution is shifted to left of the injected parameters, shown in the second panel of Fig.~\ref{par_est:results:ppplot_example}, i.e. the true value lies in the upper tail of the posterior for each simulation, then the p-p plot will show a curve below the diagonal. 
If the posterior is under constrained, shown in the third panel of Fig.~\ref{par_est:results:ppplot_example}, i.e. the posterior is wider than the perfectly recovered posterior, then the curve will follow an S shape where the S is below the diagonal at $C < 0$.5 and above the diagonal at $C > 0.5$.
Similarly, if the posterior is over constrained, shown in the fourth panel of Fig.~\ref{par_est:results:ppplot_example},i.e. the posterior is narrower than the perfectly recovered posterior, then the curve will follow an S shape where the S is above the diagonal at $C < 0.5$ and below the diagonal at $C> 0.5$.
%
\begin{figure}[ht]
    \centering
    \includegraphics[width=\linewidth]{C5_parameter/ppplot_examples.pdf}
    \caption[p-p plot examples]{This figure shows examples of p-p plots for posterior distributions which are shifted to the right (larger values of the parameter), to the left (smaller values of the parameter) and over and under constrained posteriors. The black curve shows the p-p plot when the posterior distribution is perfectly recovered, i.e. the confidence intervals follow a uniform distribution.}
    \label{par_est:results:ppplot_example}
\end{figure}

Using this information, we can look at the p-p plot for the 200 simulations in this test, which is shown in Fig.~\ref{par_est:results:ppplot}.
We can see that for the parameters $f$ and $\dot{f}$ we recover an under constrained posterior distribution.
For the \gls{SNR} parameter $\rho$, the recovered posterior is shifted to the right and is over constrained, i.e. we assume higher \glspl{SNR} than perfectly recovered distribution.
For both the right ascension parameter $\alpha$ and the declination parameter $\delta$, we can see that we recover over constrained posterior distributions, therefore, we are overconfident that the estimation of these parameters are correct.
Each of these indicate that the current analysis does not correctly reproduce the true posterior distribution.
%
\begin{figure}[ht]
    \centering
    \includegraphics[width=\linewidth]{C5_parameter/ppplot.pdf}
    \caption[p-p plot for the CW simulations]{The p-p plot is shown for the 200 signals described in Sec.~\ref{par_est:results}, which range between 40 and 200 in \gls{SNR}. This describes how well the \joe{need to figure out the error of the confidence interval}\joe{more}}
    \label{par_est:results:ppplot}
\end{figure}

In our definition of the likelihood in Sec.~\ref{par_est:bayes:likelihood}, to simplify the problem we assume that all track components are independent. 
This is not necessarily true and could contribute to the over constrained posterior distributions, where in the future we aim to use a likelihood which is dependent on the track components.
\joe{say why this doesnt work and how it could be improved}

\subsubsection{Sky area at given confidence interval}

If we assume that the estimated posterior distribution is correct recovered, i.e. it is not under constrained or shifted, then we can estimate the area of the sky which this method can localise the source to. 
To do this we can use our estimation of the marginal posterior distribution on the sky, and draw a contour on the posterior which contains 95\% of the probability.
The area contained within this contour is then the sky area which the source can be localised to at a 95\% confidence, this can be seen as the green contour in Fig.~\ref{par_est:results:sky_area_example}.
Similarly, the sky area which contains the injected sky position parameters can be found, shown as the red contour in Fig.~\ref{par_est:results:sky_area_example}.
This is another measure of the ability of this method to localise the sky position.
%
\begin{figure}[ht]
    \centering
    \includegraphics[width=\linewidth]{C5_parameter/skyarea_example.pdf}
    \caption[Area of sky at 95\% confidence]{For the injection in Sec.~\ref{par_est:results:example_posterior}, the contour in sky position is drawn for a 95\% confidence and the area which contains the injected sky position parameters.}
    \label{par_est:results:sky_area_example}
\end{figure}

The contours and therefore sky areas described above can be calculated for all of the simulations described in Sec.~\ref{par_est:results}, where Fig.~\ref{par_est:results:sky_area} shows the histograms of the sky areas at 95\% confidence and sky areas which contain the injected parameters.
%
\begin{figure}[ht]
    \centering
    \includegraphics[width=\linewidth]{C5_parameter/sky_area_hist.pdf}
    \caption[p-p plot for the CW simulations]{A histogram of the sky area with 95\% confidence in square degrees. The entire sky has $\sim 41253$ square degrees, so assuming $\sim 2000$ square degrees \joe{motivate this} the sky area is limited to 1/20 th of the sky using this method. \joe{more}}
    \label{par_est:results:sky_area}
\end{figure}

Figure \ref{par_est:results:sky_area} shows that \joe{some} percent of the time we can localise the source to a sky area of \joe{25} square degrees with a 90\% confidence.
Given the full sky has $\sim 41253$ square degrees, this is $\sim \frac{1}{1750}$ of the whole sky.
For an all sky search such as Einstein@Home \citep{theligoscientificcollaborationandthevirgocollaboration2013EinsteinHome,singh2016ResultsAllsky}, which uses the Hough transform \citep{krishnan2004HoughTransform} to combine the coherently analysed segments, a grid is placed on the sky such that the parameter space if sufficiently covered whilst running the analysis at discrete points. Assuming that both the SOAP with parameter estimation method is valid and is used as the first stage in this search to reduce the size of the parameter space, Einstein@Home would only have to search over $\sim \frac{1}{1750}$ of the sky, reducing the computational cost of the first stage. 



%
%
\section{Discussion}
%
%

In this chapter I describe a Bayesian analysis to extract the doppler parameters $\alpha, \delta, f \dot{f}$ and \gls{SNR} $\rho$ of a potential \gls{CW} source from the Viterbi track which is output from the SOAP search in Sec.~\ref{soap}.
The aim of this method is to provide estimates of the \gls{CW} parameters which would also reduce the size of the parameter space for a more sensitive analysis such as Einstein@Home \citep{singh2016ResultsAllsky}. 

In Sec.~\ref{par_est:bayes} the setup of the Bayesian network is described, where the input is a Viterbi track described in Sec.~\ref{soap} and the output is a posterior distribution on a \gls{CW} signals doppler parameters.
In this model, the likelihood is empirically calculated by simulating \gls{CW} signals and recording the difference between the Viterbi track and simulated track for multiple \gls{SNR} bands. 
For each of the parameters in the search, we assume a flat prior.
In Sec.~\ref{par_est:results}, the analysis is tested on 200 simulations which had parameters drawn from the same prior as the Bayesian model.
In this section we generate p-p plots to asses the validity of this model and find that the sky position parameters are over constrained by a large factor, the \gls{SNR} is also over constrained and overestimated and the frequency and frequency derivative are under constrained.
When looking at the area contained within contours which pass through the simulated parameter, we find that ....

In its current state, the search does not provide a valid way to estimate the parameters of the source from its Viterbi track, however, this is ongoing work and we aim to develop this into a reliable technique.



